<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1" />
<title>hanbeam.kr</title>

<style>
:root{
  --W:390;
  --H:844;
}

/* 배경 영역 수정 */
.bg{
  position:absolute;
  left:0; right:0;
  /* 🔥 50px만 잘리게 수정 */
  top: calc(-50 / 844 * 100%);
  height: calc(100% + (50 / 844 * 100%));
  z-index:0;
  overflow:hidden;
}

.bg img{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit: cover;
  object-position: top center;
  opacity:0;
  transition: opacity .55s ease;
  filter: contrast(1.10) saturate(1.08);
}

.bg img.active{ opacity:1; }
</style>
</head>

<body>
  <div class="wrap">
    <div class="canvas" id="canvas">

      <!-- 배경 -->
      <div class="bg" aria-hidden="true" id="bg">
        <img class="active" src="assets/bg1.webp" alt="">
        <img src="assets/bg2.webp" alt="">
        <img src="assets/bg3.webp" alt="">
        <img src="assets/bg4.webp" alt="">
      </div>
      <div class="overlay"></div>

      <!-- 도트 -->
      <div class="dots" id="dots" aria-hidden="true"></div>

      <!-- 지점 선택 -->
      <div class="abs branch glass" id="openBranch" role="button" tabindex="0">
        <div class="txt" id="branchText">전국 11개 지점 운영중 | 희망 지점을 선택하세요.</div>
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 9L12 15L18 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>

      <!-- 액션 -->
      <div class="abs action-panel glass">
        <div class="btnRow">
          <div class="btnCol">
            <a class="actionPng" id="btnCall" href="#"
               style="background-image:url('assets/btn-call.png');" aria-label="전화문의"></a>
            <div class="btnLabel">전화문의</div>
          </div>

          <div class="btnCol">
            <a class="actionPng" id="btnKakao" href="javascript:void(0)"
               style="background-image:url('assets/btn-kakao.png');" aria-label="카톡문의"></a>
            <div class="btnLabel">카톡문의</div>
          </div>

          <div class="btnCol">
            <a class="actionPng" id="btnReserve" href="#"
               style="background-image:url('assets/btn-reserve.png');" aria-label="네이버예약"></a>
            <div class="btnLabel">네이버예약</div>
          </div>

          <div class="btnCol">
            <a class="actionPng" id="btnMore" href="https://hanbeam.co.kr"
               style="background-image:url('assets/btn-more.png');" aria-label="더 알아보기"></a>
            <div class="btnLabel">더 알아보기</div>
          </div>
        </div>
      </div>

      <!-- 사업자정보 보기 바 -->
      <div class="infoBar" id="openBiz" role="button" tabindex="0">
        광고운영사 정보 보기
      </div>

      <!-- 토스트 -->
      <div class="toast" id="toast">준비중입니다.</div>

      <!-- 지점 선택 모달 -->
      <div class="modal-backdrop" id="branchBackdrop" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-label="지점 선택">
          <div class="modalHead">
            <div>지점 선택</div>
            <button id="closeBranch" type="button">닫기</button>
          </div>
          <div class="modalBody" id="branchList"></div>
        </div>
      </div>

      <!-- 사업자정보 모달 -->
      <div class="modal-backdrop" id="bizBackdrop" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-label="광고운영사 정보">
          <div class="modalHead">
            <div>광고운영사 정보</div>
            <button id="closeBiz" type="button">닫기</button>
          </div>
          <div class="modalBody">
            <div class="bizText">
|  광고운영사 정보  |
운영사 : ㈜브이커뮤니케이션    |    대표자 : 김정태    |    사업자등록번호 : 744-87-02865
주소 : 부산광역시 남구 수영로 74-5, 210호(문현동, 무학프라자)
고객센터 : 051-711-3722    |    이메일 : contact@v-comm.co.kr    |    제휴사 : 한빔한복 전지점

본 페이지는 ㈜브이커뮤니케이션이 운영·관리하는 공식 상담 페이지입니다.
한복 상담 및 제작은 제휴 업체와 협업하여 진행됩니다.
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /*********************************************************
     *  🔐 GAS WebApp Endpoint (반드시 교체)
     *  예: https://script.google.com/macros/s/AKfycb.../exec
     *********************************************************/
    const LOG_ENDPOINT = "https://script.google.com/macros/s/AKfycbzffPcpmzRqRPZQSEWZLHP8iJX2xMvl7Aw6SxkZutPac-kEPNAxSIt1vLqNhn_wxMGI/exec";

    /* ✅ 배경 전환 속도: 5.5초 */
    const SLIDE_INTERVAL_MS = 5500;

    /* 지점 데이터 */
    const BRANCHES = [
      { name:"부산점",     phone:"051.634.2325", reserve:"https://m.booking.naver.com/booking/6/bizes/661812" },
      { name:"부산센텀점", phone:"010-3052-2325", reserve:"https://booking.naver.com/booking/13/bizes/868629" },
      { name:"김해점",     phone:"010.8065.2325", reserve:"https://booking.naver.com/booking/6/bizes/1402679" },
      { name:"창원점",     phone:"055.263.2325", reserve:"https://booking.naver.com/booking/6/bizes/843111" },
      { name:"양산점",     phone:"055.912.0425", reserve:"https://booking.naver.com/booking/13/bizes/868629" },
      { name:"진주점",     phone:"010.5654.2407", reserve:"https://m.booking.naver.com/booking/6/bizes/1485854" },
      { name:"인천점",     phone:"032.283.2325", reserve:"https://m.booking.naver.com/booking/13/bizes/1039475" },
      { name:"안산점",     phone:"010.6591.2322", reserve:"https://m.booking.naver.com/booking/6/bizes/1500008" },
      { name:"마산점",     phone:"010.8832.2325", reserve:"https://booking.naver.com/booking/6/bizes/1526541" },
      { name:"울산점",     phone:"010.9807.2325", reserve:"https://booking.naver.com/booking/6/bizes/1534767" },
      { name:"대구점",     phone:"010-8492-2328", reserve:"https://m.place.naver.com/place/2043617700/ticket?entry=pll&bk_query=%ED%95%9C%EB%B9%94%ED%95%9C%EB%B3%B5" }
    ];

    /* ===== 유틸 ===== */
    function getDeviceType(){
      const ua = navigator.userAgent || "";
      return (/Android|iPhone|iPad|iPod|Mobile/i.test(ua)) ? "mobile" : "pc";
    }
    function getSessionId(){
      const k = "HB_LANDING_SID";
      let v = localStorage.getItem(k);
      if(!v){
        v = (crypto && crypto.randomUUID) ? crypto.randomUUID() : (Date.now()+"_"+Math.random().toString(16).slice(2));
        localStorage.setItem(k, v);
      }
      return v;
    }
    function getUTM(){
      const p = new URLSearchParams(location.search);
      return {
        utm_source: p.get("utm_source") || "",
        utm_medium: p.get("utm_medium") || "",
        utm_campaign: p.get("utm_campaign") || "",
        utm_content: p.get("utm_content") || "",
        utm_term: p.get("utm_term") || ""
      };
    }
    function toTelHref(phone){
      const digits = String(phone || "").replace(/[^\d]/g, "");
      return digits ? ("tel:" + digits) : "";
    }

    /* ===== 보안/호환 최적 로깅: sendBeacon 우선, 절대 await 금지 ===== */
    function logEventNoWait(type, data = {}) {
      const utm = getUTM();
      const payload = {
        v: "1",
        type,                       // visit | click | branch_select
        sessionId: getSessionId(),
        device: getDeviceType(),
        branch: state.branch?.name || "",
        action: data.action || "",  // call | reserve | more | kakao_pending
        href: data.href || "",
        page: location.pathname || "/",
        referrer: document.referrer || "",
        userAgent: navigator.userAgent || "",
        lang: navigator.language || "",
        screen: `${window.innerWidth}x${window.innerHeight}`,
        ts: Date.now(),
        extra: data.extra ? JSON.stringify(data.extra) : "",
        ...utm
      };

      try{
        const blob = new Blob([JSON.stringify(payload)], { type: "text/plain;charset=utf-8" });
        if (navigator.sendBeacon) {
          navigator.sendBeacon(LOG_ENDPOINT, blob);
          return;
        }
      }catch(e){}

      try{
        fetch(LOG_ENDPOINT, {
          method:"POST",
          headers:{ "Content-Type":"text/plain;charset=utf-8" },
          body: JSON.stringify(payload),
          keepalive: true
        });
      }catch(e){}
    }

    /* ===== Toast ===== */
    const toastEl = document.getElementById("toast");
    let toastTimer = null;
    function showToast(msg){
      toastEl.textContent = msg || "준비중입니다.";
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toastEl.classList.remove("show"), 1400);
    }

    /* ===== 지점 모달 ===== */
    const state = { branch: null };

    const branchBackdrop = document.getElementById("branchBackdrop");
    const openBranch = document.getElementById("openBranch");
    const closeBranch = document.getElementById("closeBranch");
    const branchList = document.getElementById("branchList");
    const branchText = document.getElementById("branchText");

    function openBranchModal(){
      branchBackdrop.classList.add("open");
      branchBackdrop.setAttribute("aria-hidden","false");
    }
    function closeBranchModal(){
      branchBackdrop.classList.remove("open");
      branchBackdrop.setAttribute("aria-hidden","true");
    }
    function renderBranchList(){
      branchList.innerHTML = "";
      BRANCHES.forEach(b=>{
        const el = document.createElement("div");
        el.className = "item";
        el.innerHTML = `<div>${b.name}</div><div class="badge">선택</div>`;
        el.addEventListener("click", ()=>selectBranch(b));
        branchList.appendChild(el);
      });
    }
    function selectBranch(b){
      state.branch = b;
      branchText.textContent = `${b.name} 선택됨 | 다시 선택하려면 눌러주세요`;
      // tel/reserve는 클릭에서 최종 이동 (Safari 안정)
      btnReserve.href = b.reserve || "#";
      logEventNoWait("branch_select", { extra:{ branch: b.name } });
      closeBranchModal();
    }

    renderBranchList();
    openBranch.addEventListener("click", openBranchModal);
    openBranch.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") openBranchModal(); });
    closeBranch.addEventListener("click", closeBranchModal);
    branchBackdrop.addEventListener("click", (e)=>{ if(e.target===branchBackdrop) closeBranchModal(); });

    /* ===== 사업자정보 모달 ===== */
    const bizBackdrop = document.getElementById("bizBackdrop");
    const openBiz = document.getElementById("openBiz");
    const closeBiz = document.getElementById("closeBiz");

    function openBizModal(){
      bizBackdrop.classList.add("open");
      bizBackdrop.setAttribute("aria-hidden","false");
    }
    function closeBizModal(){
      bizBackdrop.classList.remove("open");
      bizBackdrop.setAttribute("aria-hidden","true");
    }
    openBiz.addEventListener("click", openBizModal);
    openBiz.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") openBizModal(); });
    closeBiz.addEventListener("click", closeBizModal);
    bizBackdrop.addEventListener("click", (e)=>{ if(e.target===bizBackdrop) closeBizModal(); });

    /* ===== 버튼 동작 + 추적 ===== */
    const btnCall = document.getElementById("btnCall");
    const btnKakao = document.getElementById("btnKakao");
    const btnReserve = document.getElementById("btnReserve");
    const btnMore = document.getElementById("btnMore");

    function requireBranchOrOpenModal(e){
      if(!state.branch){
        e?.preventDefault?.();
        openBranchModal();
        return true;
      }
      return false;
    }

    // ✅ Safari 차단 방지: 로깅은 sendBeacon(대기 없음), 전화는 즉시 location 이동
    btnCall.addEventListener("click", (e)=>{
      e.preventDefault();
      if(requireBranchOrOpenModal(e)) return;

      const telHref = toTelHref(state.branch.phone);
      if(!telHref) return;

      logEventNoWait("click", { action:"call", href: telHref });
      window.location.href = telHref;
    });

    btnKakao.addEventListener("click", (e)=>{
      e.preventDefault();
      showToast("준비중입니다.");
      logEventNoWait("click", { action:"kakao_pending", href:"" });
    });

    btnReserve.addEventListener("click", (e)=>{
      e.preventDefault();
      if(requireBranchOrOpenModal(e)) return;

      const href = state.branch.reserve || btnReserve.href || "";
      logEventNoWait("click", { action:"reserve", href });
      if(href) window.location.href = href;
    });

    btnMore.addEventListener("click", (e)=>{
      // 외부 이동은 기본 href로, 로깅만 먼저
      logEventNoWait("click", { action:"more", href: btnMore.href });
    });

    /* ===== 방문 1회 기록 ===== */
    (function logVisitOnce(){
      const key = "HB_VISIT_" + getSessionId();
      if(!sessionStorage.getItem(key)){
        sessionStorage.setItem(key, "1");
        logEventNoWait("visit", { extra:{ ts: Date.now() } });
      }
    })();

    /* ===== 슬라이드 + 도트 + 스와이프 ===== */
    const canvas = document.getElementById("canvas");
    const slides = Array.from(document.querySelectorAll(".bg img"));
    const dotsWrap = document.getElementById("dots");

    let idx = 0;
    let timer = null;
    let pausedUntil = 0;

    function buildDots(){
      dotsWrap.innerHTML = "";
      slides.forEach((_, i)=>{
        const d = document.createElement("div");
        d.className = "dot" + (i===idx ? " on" : "");
        dotsWrap.appendChild(d);
      });
    }
    function setDots(){
      const ds = dotsWrap.querySelectorAll(".dot");
      ds.forEach((d,i)=> d.classList.toggle("on", i===idx));
    }
    function showSlide(n){
      slides[idx].classList.remove("active");
      idx = (n + slides.length) % slides.length;
      slides[idx].classList.add("active");
      setDots();
    }
    function next(){ showSlide(idx + 1); }
    function prev(){ showSlide(idx - 1); }

    function startAuto(){
      stopAuto();
      timer = setInterval(()=>{
        if(Date.now() < pausedUntil) return;
        next();
      }, SLIDE_INTERVAL_MS);
    }
    function stopAuto(){
      if(timer){ clearInterval(timer); timer = null; }
    }
    function pauseAuto(ms){ pausedUntil = Date.now() + ms; }

    buildDots();
    startAuto();

    // 스와이프
    let touchX0 = null, touchY0 = null, moved = false;
    canvas.addEventListener("touchstart", (e)=>{
      if(!e.touches || e.touches.length !== 1) return;
      touchX0 = e.touches[0].clientX;
      touchY0 = e.touches[0].clientY;
      moved = false;
    }, { passive:true });

    canvas.addEventListener("touchmove", (e)=>{
      if(touchX0 === null) return;
      const dx = e.touches[0].clientX - touchX0;
      const dy = e.touches[0].clientY - touchY0;
      if(Math.abs(dx) > 18 && Math.abs(dx) > Math.abs(dy)) moved = true;
    }, { passive:true });

    canvas.addEventListener("touchend", (e)=>{
      if(touchX0 === null) return;
      const x1 = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientX : touchX0;
      const dx = x1 - touchX0;
      if(moved && Math.abs(dx) > 42){
        if(dx < 0) next(); else prev();
        pauseAuto(8000);
      }
      touchX0 = null; touchY0 = null; moved = false;
    }, { passive:true });
  </script>
</body>
</html>
