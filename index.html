<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>hanbeam.kr</title>

  <!-- 보안/평판 안정 (외부 의존성 최소) -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'self';
          img-src 'self' data:;
          style-src 'self' 'unsafe-inline';
          script-src 'self' 'unsafe-inline';
          connect-src 'self' https://script.google.com https://script.googleusercontent.com;
          base-uri 'none';
          object-src 'none';
          frame-ancestors 'none';
        " />

  <link rel="preload" as="image" href="assets/bg1.webp" />

  <style>
    :root{
      /* 390x844 디자인을 “비율”로 재현하기 위한 기준값 */
      --W: 390;
      --H: 844;

      --glass-bg: rgba(255,255,255,0.52);
      --glass-blur: 10px;
      --glass-border: rgba(255,255,255,0.28);

      --footer-bg: rgba(0,0,0,0.45);
      --footer-border: rgba(255,255,255,0.12);

      --text-dark: #2a1b17;
      --text-white: rgba(255,255,255,0.92);
      --text-white-soft: rgba(255,255,255,0.78);

      --maxW: 480px; /* PC에서 너무 커지지 않게 */
    }

    *{ box-sizing:border-box; }
    html, body { height: 100%; margin:0; }
    body{
      background:#0b0b0b;
      font-family: system-ui, -apple-system, "Nanum Gothic Neo","Apple SD Gothic Neo","Noto Sans KR", sans-serif;
      overflow:hidden;
    }

    .wrap{
      width:100vw; height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding: 0;
    }

    /* “기기 화면” 프레임 */
    .screen{
      position:relative;
      width: min(100vw, var(--maxW));
      aspect-ratio: calc(var(--W) / var(--H));
      overflow:hidden;
      border-radius: 22px;
      background:#000;
      box-shadow: 0 20px 80px rgba(0,0,0,0.45);
    }

    .bg{ position:absolute; inset:0; z-index:0; }
    .bg img{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      opacity:0;
      transition: opacity .6s ease;
    }
    .bg img.active{ opacity:1; }

    .overlay{
      position:absolute; inset:0; z-index:1;
      pointer-events:none;
      background: linear-gradient(to bottom,
        rgba(0,0,0,0.00) 45%,
        rgba(0,0,0,0.55) 100%);
    }

    .glass{
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border: 1px solid var(--glass-border);
      box-shadow:
        0 10px 24px rgba(0,0,0,0.16),
        0 2px 6px rgba(0,0,0,0.10),
        inset 0 1px 0 rgba(255,255,255,0.55);
    }

    .abs{ position:absolute; z-index:2; }

    /* =========================
       390x844 기준을 %로 환산
       ========================= */

    /* 지점 버튼: 357 x 34.5 @ (16.5, 538.1) */
    .branch{
      left:  calc(16.5 / 390 * 100%);
      top:   calc(538.1 / 844 * 100%);
      width: calc(357 / 390 * 100%);
      height:calc(34.5 / 844 * 100%);
      border-radius: 999px;
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 0 12px;
      cursor:pointer;
      user-select:none;
      color: var(--text-dark);
    }
    .branch .txt{
      flex:1;
      font-weight:900;
      font-size: clamp(12px, 1.9vw, 13px);
      letter-spacing: -0.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .branch svg{
      width: 14px;
      height: 14px;
      opacity:.85;
      flex: 0 0 auto;
    }
    .branch svg path{ stroke: var(--text-dark); }

    /* 액션 패널: 357 x 97 @ (16.5, 583) */
    .action-panel{
      left:  calc(16.5 / 390 * 100%);
      top:   calc(583 / 844 * 100%);
      width: calc(357 / 390 * 100%);
      height:calc(97 / 844 * 100%);
      border-radius: 22px;
      padding: 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }

    /* 버튼 PNG: 63.9 x 63.9 (정사각) */
    .actionPng{
      width:  calc(63.9 / 390 * 100%);
      aspect-ratio: 1 / 1;
      height: auto;
      border-radius: 18px;
      display:block;
      background-size: cover;
      background-position: center;
      background-repeat:no-repeat;
      text-decoration:none;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .actionPng:active{ transform: translateY(1px); }

    .sr-only{
      position:absolute;
      width:1px; height:1px;
      padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0);
      white-space:nowrap; border:0;
    }

    /* 푸터: 357 x 114 @ (16.5, 690) */
    .footer{
      left:  calc(16.5 / 390 * 100%);
      top:   calc(690 / 844 * 100%);
      width: calc(357 / 390 * 100%);
      height:calc(114 / 844 * 100%);
      border-radius: 18px;
      background: var(--footer-bg);
      border: 1px solid var(--footer-border);
      padding: 10px 12px;
      color: var(--text-white-soft);
      overflow:hidden;
    }
    .footer .title{
      font-weight:900;
      font-size: clamp(11px, 1.7vw, 12px);
      color: var(--text-white);
      margin-bottom: 6px;
    }
    .footer .meta{
      font-size: clamp(9px, 1.45vw, 10px);
      line-height: 1.28;
      letter-spacing: -0.01em;
    }
    .footer hr{
      border:0;
      height:1px;
      background: rgba(255,255,255,0.18);
      margin: 8px 0;
    }
    .footer .note{
      font-size: clamp(9px, 1.45vw, 10px);
      line-height: 1.3;
      color: rgba(255,255,255,0.86);
    }

    /* ===== Modal ===== */
    .modal-backdrop{
      position:absolute; inset:0; z-index:50;
      display:none; align-items:flex-end; justify-content:center;
      padding: 16px;
      background: rgba(0,0,0,0.50);
    }
    .modal-backdrop.open{ display:flex; }

    .modal{
      width:100%;
      border-radius: 22px;
      overflow:hidden;
      max-width: 520px;
    }
    .modalHead{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 14px;
      color: var(--text-dark);
      font-weight:900;
      background: rgba(255,255,255,0.75);
      border-bottom: 1px solid rgba(255,255,255,0.25);
    }
    .modalHead button{
      border:none; background:transparent; cursor:pointer;
      font-weight:900; font-size: 13px;
      color: rgba(42,27,23,0.75);
    }
    .modalBody{
      padding: 12px 14px 14px;
      background: rgba(255,255,255,0.70);
    }

    .searchRow{
      height: 42px;
      border-radius: 14px;
      display:flex; align-items:center; gap: 8px;
      padding: 0 12px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.65);
      border: 1px solid rgba(255,255,255,0.25);
    }
    .searchRow svg{ width: 16px; height: 16px; opacity:.85; }
    .searchRow input{
      width:100%;
      border:none; outline:none;
      background:transparent;
      font-weight:900;
      font-size: 13px;
      color: var(--text-dark);
    }

    .list{
      max-height: 45vh;
      overflow:auto;
      border-radius: 16px;
      background: rgba(255,255,255,0.55);
      border: 1px solid rgba(255,255,255,0.25);
    }
    .item{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.22);
      cursor:pointer;
      color: var(--text-dark);
      font-weight:900;
      font-size: 13px;
    }
    .item:last-child{ border-bottom:none; }
    .item small{
      display:block;
      font-weight:800;
      font-size: 11px;
      color: rgba(42,27,23,0.62);
      margin-top: 2px;
    }
    .badge{
      font-size: 11px;
      font-weight:900;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.55);
      border: 1px solid rgba(255,255,255,0.25);
      white-space:nowrap;
    }

    /* ===== Toast ===== */
    .toast{
      position:absolute;
      left: 50%;
      bottom: 18%;
      transform: translateX(-50%);
      z-index: 80;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,0.72);
      color: rgba(255,255,255,0.95);
      font-weight: 900;
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }

    @media (prefers-reduced-motion: reduce){
      .bg img{ transition:none; }
      .toast{ transition:none; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="screen" id="screen">

      <!-- 배경 슬라이드 -->
      <div class="bg" aria-hidden="true">
        <img class="active" src="assets/bg1.webp" alt="">
        <img src="assets/bg2.webp" alt="">
        <img src="assets/bg3.webp" alt="">
        <img src="assets/bg4.webp" alt="">
        <!-- <img src="assets/bg5.webp" alt=""> -->
      </div>
      <div class="overlay"></div>

      <!-- 지점 선택 버튼 -->
      <div class="abs branch glass" id="openBranch" role="button" tabindex="0">
        <div class="txt" id="branchText">전국 11개 지점 운영중 | 희망 지점을 선택하세요.</div>
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 9L12 15L18 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>

      <!-- 액션 버튼(네 디자인 PNG 4개) -->
      <div class="abs action-panel glass">
        <a class="actionPng" id="btnCall" href="#"
           style="background-image:url('assets/btn-call.png');" aria-label="전화문의">
          <span class="sr-only">전화문의</span>
        </a>
        <a class="actionPng" id="btnKakao" href="javascript:void(0)"
           style="background-image:url('assets/btn-kakao.png');" aria-label="카톡문의">
          <span class="sr-only">카톡문의</span>
        </a>
        <a class="actionPng" id="btnReserve" href="#"
           style="background-image:url('assets/btn-reserve.png');" aria-label="네이버예약">
          <span class="sr-only">네이버예약</span>
        </a>
        <a class="actionPng" id="btnMore" href="https://hanbeam.co.kr"
           style="background-image:url('assets/btn-more.png');" aria-label="더 알아보기">
          <span class="sr-only">더 알아보기</span>
        </a>
      </div>

      <!-- 푸터 -->
      <div class="abs footer" aria-label="광고운영사 정보">
        <div class="title">|&nbsp;&nbsp;광고운영사 정보&nbsp;&nbsp;|</div>
        <div class="meta">
          운영사 : ㈜브이커뮤니케이션 &nbsp;&nbsp;|&nbsp;&nbsp; 대표자 : 김정태 &nbsp;&nbsp;|&nbsp;&nbsp; 사업자등록번호 : 744-87-02865<br>
          주소 : 부산광역시 남구 수영로 74-5, 210호(문현동, 무학프라자)<br>
          고객센터 : 051-711-3722 &nbsp;&nbsp;|&nbsp;&nbsp; 이메일 : contact@v-comm.co.kr &nbsp;&nbsp;|&nbsp;&nbsp; 제휴사 : 한빔한복 전지점
        </div>
        <hr>
        <div class="note">
          본 페이지는 ㈜브이커뮤니케이션이 운영·관리하는 공식 상담 페이지입니다.<br>
          한복 상담 및 제작은 제휴 업체와 협업하여 진행됩니다.
        </div>
      </div>

      <!-- 토스트 -->
      <div class="toast" id="toast">준비중입니다.</div>

      <!-- 지점 선택 모달 -->
      <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-label="지점 선택">
          <div class="modalHead">
            <div>지점 선택</div>
            <button id="closeModal" type="button">닫기</button>
          </div>
          <div class="modalBody">
            <div class="searchRow">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <circle cx="11" cy="11" r="7" stroke="#2a1b17" stroke-width="2"></circle>
                <line x1="16.65" y1="16.65" x2="21" y2="21" stroke="#2a1b17" stroke-width="2"></line>
              </svg>
              <input id="branchSearch" type="text" placeholder="지점 이름 검색 (예: 부산, 김해, 창원)" autocomplete="off">
            </div>
            <div class="list" id="branchList"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /************ 반드시 교체 ************/
    const LOG_ENDPOINT = "https://script.google.com/macros/s/PUT_YOUR_SCRIPT_ID/exec";
    /************************************/

    const SLIDE_INTERVAL_MS = 2000;

    // ===== 지점 데이터(11개) =====
    const BRANCHES = [
      { name:"부산점",     tags:"부산", phone:"051.634.2325", reserve:"https://m.booking.naver.com/booking/6/bizes/661812" },
      { name:"부산센텀점", tags:"부산", phone:"010-3052-2325", reserve:"https://booking.naver.com/booking/13/bizes/868629" },
      { name:"김해점",     tags:"김해", phone:"010.8065.2325", reserve:"https://booking.naver.com/booking/6/bizes/1402679" },
      { name:"창원점",     tags:"창원", phone:"055.263.2325", reserve:"https://booking.naver.com/booking/6/bizes/843111" },
      { name:"양산점",     tags:"양산", phone:"055.912.0425", reserve:"https://booking.naver.com/booking/13/bizes/868629" },
      { name:"진주점",     tags:"진주", phone:"010.5654.2407", reserve:"https://m.booking.naver.com/booking/6/bizes/1485854" },
      { name:"인천점",     tags:"인천", phone:"032.283.2325", reserve:"https://m.booking.naver.com/booking/13/bizes/1039475" },
      { name:"안산점",     tags:"안산", phone:"010.6591.2322", reserve:"https://m.booking.naver.com/booking/6/bizes/1500008" },
      { name:"마산점",     tags:"마산", phone:"010.8832.2325", reserve:"https://booking.naver.com/booking/6/bizes/1526541" },
      { name:"울산점",     tags:"울산", phone:"010.9807.2325", reserve:"https://booking.naver.com/booking/6/bizes/1534767" },
      { name:"대구점",     tags:"대구", phone:"010-8492-2328", reserve:"https://m.place.naver.com/place/2043617700/ticket?entry=pll&bk_query=%ED%95%9C%EB%B9%94%ED%95%9C%EB%B3%B5" }
    ];

    // ===== Helpers =====
    function getDeviceType(){
      const ua = navigator.userAgent || "";
      return (/Android|iPhone|iPad|iPod|Mobile/i.test(ua)) ? "mobile" : "pc";
    }
    function getSessionId(){
      const k = "HB_LANDING_SID";
      let v = localStorage.getItem(k);
      if(!v){
        v = (crypto && crypto.randomUUID) ? crypto.randomUUID() : (Date.now()+"_"+Math.random().toString(16).slice(2));
        localStorage.setItem(k, v);
      }
      return v;
    }
    function getUTM(){
      const p = new URLSearchParams(location.search);
      return {
        utm_source: p.get("utm_source") || "",
        utm_medium: p.get("utm_medium") || "",
        utm_campaign: p.get("utm_campaign") || "",
        utm_content: p.get("utm_content") || "",
        utm_term: p.get("utm_term") || ""
      };
    }
    function toTelHref(phone){
      const digits = String(phone || "").replace(/[^\d]/g, "");
      return digits ? ("tel:" + digits) : "#";
    }

    async function logEvent(type, data={}){
      const utm = getUTM();
      const payload = {
        type,
        sessionId: getSessionId(),
        device: getDeviceType(),
        branch: (state.branch && state.branch.name) ? state.branch.name : "",
        action: data.action || "",
        href: data.href || "",
        page: location.pathname || "/",
        referrer: document.referrer || "",
        userAgent: navigator.userAgent || "",
        lang: navigator.language || "",
        screen: `${window.innerWidth}x${window.innerHeight}`,
        extra: data.extra ? JSON.stringify(data.extra) : "",
        ...utm
      };

      try{
        await fetch(LOG_ENDPOINT, {
          method:"POST",
          headers:{ "Content-Type":"text/plain;charset=utf-8" },
          body: JSON.stringify(payload),
          keepalive: true
        });
      }catch(e){
        // 로그 실패는 UX에 영향 주지 않게 조용히 처리
        console.warn("logEvent failed", e);
      }
    }

    // ===== Slider =====
    (function startSlider(){
      const slides = document.querySelectorAll(".bg img");
      if(!slides.length) return;
      let i = 0;
      setInterval(()=>{
        slides[i].classList.remove("active");
        i = (i+1) % slides.length;
        slides[i].classList.add("active");
      }, SLIDE_INTERVAL_MS);
    })();

    // ===== Toast =====
    const toastEl = document.getElementById("toast");
    let toastTimer = null;
    function showToast(msg){
      toastEl.textContent = msg || "준비중입니다.";
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toastEl.classList.remove("show"), 1400);
    }

    // ===== State =====
    const state = { branch: null };

    // ===== Modal UI =====
    const modalBackdrop = document.getElementById("modalBackdrop");
    const openBranch = document.getElementById("openBranch");
    const closeModal = document.getElementById("closeModal");
    const branchSearch = document.getElementById("branchSearch");
    const branchList = document.getElementById("branchList");
    const branchText = document.getElementById("branchText");

    function renderList(items){
      branchList.innerHTML = "";
      if(items.length === 0){
        const empty = document.createElement("div");
        empty.className = "item";
        empty.style.justifyContent = "center";
        empty.innerHTML = `<small>검색 결과가 없습니다</small>`;
        branchList.appendChild(empty);
        return;
      }
      items.forEach(b=>{
        const el = document.createElement("div");
        el.className = "item";
        el.innerHTML = `
          <div>${b.name}<small>${b.tags || ""} · ${b.phone || ""}</small></div>
          <div class="badge">선택</div>
        `;
        el.addEventListener("click", ()=>selectBranch(b));
        branchList.appendChild(el);
      });
    }

    function openModal(){
      modalBackdrop.classList.add("open");
      modalBackdrop.setAttribute("aria-hidden","false");
      branchSearch.value = "";
      renderList(BRANCHES);
      setTimeout(()=>branchSearch.focus(), 30);
    }
    function closeModalFn(){
      modalBackdrop.classList.remove("open");
      modalBackdrop.setAttribute("aria-hidden","true");
    }

    const btnCall = document.getElementById("btnCall");
    const btnKakao = document.getElementById("btnKakao");
    const btnReserve = document.getElementById("btnReserve");
    const btnMore = document.getElementById("btnMore");

    function selectBranch(b){
      state.branch = b;
      branchText.textContent = `${b.name} 선택됨 | 다시 선택하려면 눌러주세요`;
      btnCall.href = toTelHref(b.phone);
      btnReserve.href = b.reserve || "#";
      logEvent("branch_select", { extra:{ branch: b.name } });
      closeModalFn();
    }

    openBranch.addEventListener("click", openModal);
    openBranch.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") openModal(); });
    closeModal.addEventListener("click", closeModalFn);
    modalBackdrop.addEventListener("click", (e)=>{ if(e.target===modalBackdrop) closeModalFn(); });

    branchSearch.addEventListener("input", ()=>{
      const q = branchSearch.value.trim().toLowerCase();
      const filtered = BRANCHES.filter(b =>
        b.name.toLowerCase().includes(q) || (b.tags || "").toLowerCase().includes(q)
      );
      renderList(filtered);
    });

    // 지점 선택 안 하면 모달 먼저 띄우기
    function requireBranchOrOpenModal(e){
      if(!state.branch){
        e.preventDefault();
        openModal();
        return true;
      }
      return false;
    }

    // CTA tracking
    btnCall.addEventListener("click", (e)=>{
      if(requireBranchOrOpenModal(e)) return;
      logEvent("click", { action:"call", href: btnCall.href });
    });

    btnKakao.addEventListener("click", (e)=>{
      e.preventDefault();
      showToast("준비중입니다.");
      logEvent("click", { action:"kakao_pending", href:"" });
    });

    btnReserve.addEventListener("click", (e)=>{
      if(requireBranchOrOpenModal(e)) return;
      logEvent("click", { action:"reserve", href: btnReserve.href });
    });

    btnMore.addEventListener("click", ()=>{
      logEvent("click", { action:"more", href: btnMore.href });
    });

    // Visit (세션당 1회)
    (function logVisitOnce(){
      const key = "HB_VISIT_" + getSessionId();
      if(!sessionStorage.getItem(key)){
        sessionStorage.setItem(key, "1");
        logEvent("visit", { extra:{ ts: Date.now() } });
      }
    })();

    // 초기 링크
    btnCall.href = "#";
    btnReserve.href = "#";
  </script>
</body>
</html>
